<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¶–∏–∫–ª –î–æ–ª–≥–∞</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- –ö–ù–û–ü–ö–ê –î–õ–Ø –ú–ï–ù–Æ –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê -->
    <button id="dev-menu-btn">Dev</button>
    <!-- <button id="switch-style2-btn" class="style2-switch-btn" style="position:fixed;top:10px;right:70px;z-index:1000;">Style 2</button> -->
    <div id="dev-menu-modal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width:400px;">
            <h2>–ú–µ–Ω—é —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</h2>
            <div id="dev-menu-content">
                <div class="dev-section">
                    <h3>–†–µ—Å—É—Ä—Å—ã</h3>
                    <div class="dev-buttons">
                        <button id="dev-add-coins" class="dev-button money">+1000 –º–æ–Ω–µ—Ç</button>
                        <button id="dev-add-tickets" class="dev-button ticket">+100 —Ç–∞–ª–æ–Ω–æ–≤</button>
                        <button id="dev-set-interest" class="dev-button">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É 50%</button>
                    </div>
                </div>

                <div class="dev-section">
                    <h3>–ü—Ä–µ–¥–º–µ—Ç—ã</h3>
                    <div class="dev-item-control">
                        <select id="dev-item-select" class="dev-select"></select>
                        <button id="dev-give-item" class="dev-button">–í—ã–¥–∞—Ç—å</button>
                    </div>
                </div>

                <div class="dev-section">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∞–Ω—Å–æ–≤</h3>
                    <div id="dev-symbol-chances" class="dev-chances"></div>
                    <button id="dev-apply-chances" class="dev-button">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —à–∞–Ω—Å—ã</button>
                </div>

                <div class="dev-section">
                    <h3>–£–¥–∞—á–∞</h3>
                    <div class="dev-luck-control">
                        <input type="number" id="dev-luck-input" class="dev-input" placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ —É–¥–∞—á–∏">
                        <button id="dev-apply-luck" class="dev-button">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                    </div>
                </div>

                <button id="dev-close-menu" class="dev-button dev-close">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="game-container">
        <div class="main-panel">
            <div class="slot-area">
                <div id="slot-machine" class="slot-machine"></div>
                <div class="lever-container">
                    <div id="lever" class="lever"><div class="lever-handle"></div></div>
                    <div class="lever-base"></div>
                </div>
            </div>
            <div class="controls">
                <span>–ü—Ä–æ–∫—Ä—É—Ç–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å: <span id="spins-left">0</span></span>
                <button id="btn-end-turn">–ó–∞–∫–æ–Ω—á–∏—Ç—å —Ä–∞—É–Ω–¥</button>
                <button id="btn-show-run-stats" style="margin-left: 8px;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                <button id="btn-toggle-log" style="margin-left: 8px;">–õ–æ–≥</button>
            </div>
             <!-- –ê–ú–£–õ–ï–¢–´ –ü–ï–†–ï–ú–ï–©–ï–ù–´ –°–Æ–î–ê -->
            <div class="ui-box">
                <h3>–ê–º—É–ª–µ—Ç—ã</h3>
                <div id="inventory-items" class="inventory-items"></div>
            </div>
        </div>

        <div class="ui-panel">
            <div class="ui-box">
                <h3>–¶–∏–∫–ª <span id="stat-run" style="color: var(--highlight-color);">1</span></h3>
                <div class="stats-grid compact-stats">
                    <span>–†–∞—É–Ω–¥:</span><span id="stat-turn">1 / 3</span>
                    <span style="color: var(--money-color);">–ù–∞–ª–∏—á–Ω—ã–µ:</span><span id="stat-coins" style="color: var(--money-color);">0</span>
                    <span style="color: var(--ticket-color);">–¢–∞–ª–æ–Ω—ã:</span><span id="stat-tickets" style="color: var(--ticket-color);">0</span>
                    <span style="color: var(--luck-color);">–£–¥–∞—á–∞:</span><span id="stat-luck" style="color: var(--luck-color);">0</span>
                </div>
            </div>
            <div class="ui-box">
                <h3>–ë–∞–Ω–∫ <span id="bank-balance" style="color: var(--money-color);">0</span></h3>
                <div class="stats-grid">
                    <span>–¶–ï–õ–¨:</span><span id="stat-debt" style="color: var(--danger-color);">50</span>
                    <span>–°—Ç–∞–≤–∫–∞:</span><span><span id="atm-interest-rate">3</span>%</span>
                </div>
                <div class="atm-actions" style="position: relative; z-index: 10;">
                    <button id="btn-deposit">–í–Ω–µ—Å—Ç–∏ ‚ñº</button>
                    <div id="deposit-dropdown" class="deposit-dropdown hidden">
                        <div class="deposit-option" data-type="all">–í–Ω–µ—Å—Ç–∏ –≤—Å—ë</div>
                        <div class="deposit-option" data-type="except-7">–í–Ω–µ—Å—Ç–∏ –≤—Å—ë, –∫—Ä–æ–º–µ 7 –ø—Ä–æ–∫—Ä—É—Ç–æ–≤</div>
                        <div class="deposit-option" data-type="except-3">–í–Ω–µ—Å—Ç–∏ –≤—Å—ë, –∫—Ä–æ–º–µ 3 –ø—Ä–æ–∫—Ä—É—Ç–æ–≤</div>
                        <div class="deposit-option" data-type="half">–í–Ω–µ—Å—Ç–∏ –ø–æ–ª–æ–≤–∏–Ω—É</div>
                    </div>
                </div>
                <div id="early-payoff-section" class="early-payoff-section">
                    <button id="btn-pay-debt-early">–í—ã–ø–ª–∞—Ç–∏—Ç—å –¥–æ–ª–≥ –¥–æ—Å—Ä–æ—á–Ω–æ</button>
                    <div id="early-payoff-bonus-info" class="early-payoff-info"></div>
                </div>
            </div>
            <div class="ui-box">
                <h3>–ú–∞–≥–∞–∑–∏–Ω <button id="btn-reroll-shop" style="float: right; font-size: 12px; padding: 5px 8px;">Reroll (2üéüÔ∏è)</button></h3>
                <div id="shop-items" class="shop-items"></div>
            </div>
        </div>
    </div>

    <!-- –í—Å–ø–ª—ã–≤–∞—é—â–∞—è –ø–∞–Ω–µ–ª—å –ª–æ–≥–∞ -->
    <div id="log-panel-wrapper" class="log-panel-wrapper">
        <div class="log-panel-header">
            <h3>–õ–æ–≥ –†–∞—É–Ω–¥–∞</h3>
            <button id="btn-close-log" class="log-panel-close">&times;</button>
        </div>
        <div id="log-panel" class="log-panel" style="flex-grow: 1; overflow-y: auto; padding: 10px;">
            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ª–æ–≥–∞, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–µ skript.js -->
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="start-screen" class="modal-overlay">
        <div class="modal-content">
            <h2>–¶–∏–∫–ª –î–æ–ª–≥–∞</h2>
            <p>–£ –≤–∞—Å –µ—Å—Ç—å 3 —Ä–∞—É–Ω–¥–∞ (–¥–Ω—è), —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å —Å—É–º–º—É –¥–ª—è –≤—ã–ø–ª–∞—Ç—ã –¥–æ–ª–≥–∞. –í–Ω–æ—Å–∏—Ç–µ –¥–µ–Ω—å–≥–∏ –≤ –±–∞–Ω–∫, –ø–æ–∫—É–ø–∞–π—Ç–µ –ø—Ä–æ–∫—Ä—É—Ç—ã –∏ –∞–º—É–ª–µ—Ç—ã, –∏ –º–æ–ª–∏—Ç–µ—Å—å –æ–± —É–¥–∞—á–µ. –ï—Å–ª–∏ –∫ –∫–æ–Ω—Ü—É 3-–≥–æ –¥–Ω—è —É –≤–∞—Å –Ω–µ –±—É–¥–µ—Ç –Ω—É–∂–Ω–æ–π —Å—É–º–º—ã... –≤—ã –ø—Ä–æ–≤–∞–ª–∏—Ç–µ—Å—å –≤ —è–º—É.</p>
            <div id="start-debt-amount" style="color: var(--danger-color); font-size: 1.5em; font-weight: bold; margin: 10px 0; animation: debt-pulse 1.2s infinite alternate;">–í—Å–µ–≥–æ –¥–æ–ª–≥: <span id="stat-debt" style="color: var(--danger-color);">88,888,888 –º–ª–Ω</span>üí∞</div>
            <button id="btn-show-tutorial" style="margin-bottom: 10px;">–ö–∞–∫ –∏–≥—Ä–∞—Ç—å?</button>
            <button id="btn-start-game">–ù–∞—á–∞—Ç—å</button>
        </div>
    </div>
    <div id="game-over-screen" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="shake">–í–´ –ü–†–û–í–ê–õ–ò–õ–ò–°–¨ –í –Ø–ú–£</h2>
            <p>–°—É–¥–Ω—ã–π –¥–µ–Ω—å –Ω–∞—Å—Ç–∞–ª, –∞ –¥–µ–Ω–µ–≥ –Ω–µ—Ç. –¢—å–º–∞ –ø–æ–≥–ª–æ—â–∞–µ—Ç –≤–∞—Å.</p>
            <p>–í—ã –ø—Ä–æ–¥–µ—Ä–∂–∞–ª–∏—Å—å: <span id="final-run"></span> —Ü–∏–∫–ª(–æ–≤).</p>
            <button id="btn-restart-game">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>
    </div>
    <div id="spin-purchase-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 id="purchase-modal-title">–†–∞—É–Ω–¥ 1. –í—Ä–µ–º—è –∑–∞–∫—É–ø–∞—Ç—å—Å—è.</h2>
            <p>–í–∞—à–∏ –Ω–∞–ª–∏—á–Ω—ã–µ: <span id="purchase-modal-coins" style="color: var(--money-color)">0</span>. –í—ã–±–µ—Ä–∏—Ç–µ, –∫–∞–∫ –≤—ã –ø–æ—Ç—Ä–∞—Ç–∏—Ç–µ –¥–µ–Ω—å–≥–∏ —Å–µ–≥–æ–¥–Ω—è.</p>
            <p>–¶–∏–∫–ª –¥–æ–ª–≥–∞: <span id="purchase-modal-debt" style="color: var(--danger-color)">0</span></p>
            <div class="modal-actions">
                <button id="buy-spins-7">7 –ø—Ä–æ–∫—Ä—É—Ç–æ–≤ + 1 —Ç–∞–ª–æ–Ω (–°—Ç–æ–∏–º–æ—Å—Ç—å: 10üí∞)</button>
                <button id="buy-spins-3">3 –ø—Ä–æ–∫—Ä—É—Ç–∞ + 2 —Ç–∞–ª–æ–Ω–∞ (–°—Ç–æ–∏–º–æ—Å—Ç—å: 7üí∞)</button>
                <button id="buy-spin-1">1 –ø—Ä–æ–∫—Ä—É—Ç (3üí∞, –±–µ–∑ —Ç–∞–ª–æ–Ω–æ–≤)</button>
                <button id="buy-nothing">–ù–∏—á–µ–≥–æ. –Ø —Å–ø—Ä–∞–≤–ª—é—Å—å.</button>
            </div>
            <div id="spin-cost-tooltip" class="spin-cost-tooltip" style="display:none; position:absolute; z-index:2000; font-size:0.98em; background:var(--cell-bg,#232323); border:1px solid var(--border-color,#444); border-radius:6px; padding:10px; color:var(--text-color,#fff); box-shadow:0 2px 12px #0005; pointer-events:none; transition:opacity 0.15s; opacity:0;"></div>
            <button id="btn-planning" style="margin-top: 10px; background-color: var(--ticket-color); border-color: var(--ticket-color);">üìã –†–µ–∂–∏–º –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</button>
        </div>
    </div>
    <!-- –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –†–ï–ñ–ò–ú–ê –ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–Ø -->
    <div id="planning-modal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
            <h2>üìã –†–µ–∂–∏–º –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
            <p>–ü–æ–∫—É–ø–∞–π—Ç–µ –∞–º—É–ª–µ—Ç—ã –∏ –¥—Ä—É–≥–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–≤–æ–∏—Ö —à–∞–Ω—Å–æ–≤.</p>
            
            <div style="text-align: center; margin: 15px 0; padding: 10px; background-color: var(--cell-bg); border-radius: 4px; border: 1px solid var(--border-color);">
                <span style="color: var(--ticket-color); font-weight: bold;">–í–∞—à–∏ —Ç–∞–ª–æ–Ω—ã: <span id="planning-tickets">0</span>üéüÔ∏è</span>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                <div>
                    <h3 style="color: var(--ticket-color);">–ú–∞–≥–∞–∑–∏–Ω –∞–º—É–ª–µ—Ç–æ–≤</h3>
                    <div id="planning-shop-items" class="shop-items"></div>
                    <button id="btn-planning-reroll" style="margin-top: 10px; font-size: 12px; padding: 5px 8px;">Reroll (2üéüÔ∏è)</button>
                </div>
                <div>
                    <h3 style="color: var(--highlight-color);">–í–∞—à–∏ –∞–º—É–ª–µ—Ç—ã</h3>
                    <div id="planning-inventory-items" class="inventory-items"></div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button id="btn-finish-planning">–ó–∞–≤–µ—Ä—à–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
            </div>
        </div>
    </div>
    <div id="end-of-round-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 id="eor-title">–ö–æ–Ω–µ—Ü –†–∞—É–Ω–¥–∞</h2>
            <p>–î–µ–Ω—å –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ –∫–æ–Ω—Ü—É. –í–Ω–µ—Å–∏—Ç–µ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è –≤ –±–∞–Ω–∫, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ä–∞—É–Ω–¥–µ.</p>
            <div class="modal-stats">
                <span>–ù–∞–ª–∏—á–Ω—ã–µ:</span><span id="eor-coins" style="color: var(--money-color)"></span>
                <span>–í –±–∞–Ω–∫–µ:</span><span id="eor-bank" style="color: var(--money-color)"></span>
            </div>
            <div class="atm-actions" style="position: relative; justify-content: center; max-width: 300px; margin: 20px auto;">
                <button id="btn-eor-deposit">–í–Ω–µ—Å—Ç–∏ ‚ñº</button>
                <div id="eor-deposit-dropdown" class="deposit-dropdown hidden">
                    <div class="deposit-option" data-type="all">–í–Ω–µ—Å—Ç–∏ –≤—Å—ë</div>
                    <div class="deposit-option" data-type="except-7">–í–Ω–µ—Å—Ç–∏ –≤—Å—ë, –∫—Ä–æ–º–µ 7 –ø—Ä–æ–∫—Ä—É—Ç–æ–≤</div>
                    <div class="deposit-option" data-type="except-3">–í–Ω–µ—Å—Ç–∏ –≤—Å—ë, –∫—Ä–æ–º–µ 3 –ø—Ä–æ–∫—Ä—É—Ç–æ–≤</div>
                    <div class="deposit-option" data-type="half">–í–Ω–µ—Å—Ç–∏ –ø–æ–ª–æ–≤–∏–Ω—É</div>
                </div>
            </div>
            <button id="btn-confirm-end-turn">–ó–∞–≤–µ—Ä—à–∏—Ç—å –†–∞—É–Ω–¥</button>
        </div>
    </div>
    <div id="judgement-modal" class="modal-overlay hidden">
         <div class="modal-content">
            <h2 id="judgement-title">–°–£–î–ù–´–ô –î–ï–ù–¨</h2>
            <p id="judgement-text">...–ø–æ–¥—Å—á–µ—Ç –æ–∫–æ–Ω—á–µ–Ω...</p>
            <button id="judgement-continue">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –°–¢–ê–¢–ò–°–¢–ò–ö–ò –ó–ê–ë–ï–ì–ê -->
    <div id="run-stats-modal" class="modal-overlay hidden">
        <div class="modal-content compact-stats-modal" style="max-width: 420px; padding: 18px 12px;">
            <h2 style="color: var(--highlight-color); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; font-size: 1.1em;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–±–µ–≥–∞</h2>
            <div class="stats-section compact">
                <h3 style="margin-bottom: 6px; font-size: 1em;">–ü–∞—Å—Å–∏–≤–∫–∏</h3>
                <div id="stats-active-passives" class="compact-passives-list"></div>
            </div>
            <div class="stats-section compact">
                <h3 style="margin-bottom: 6px; font-size: 1em;">–®–∞–Ω—Å—ã —Å–∏–º–≤–æ–ª–æ–≤</h3>
                <div id="stats-symbol-chances" class="styled-symbol-chances"></div>
            </div>
            <button id="btn-close-run-stats" style="margin-top: 10px; width: 100%; padding: 8px; background: var(--highlight-color); color: var(--bg-color); border: none; border-radius: 6px; font-weight: bold; font-size: 1em; cursor: pointer; transition: background 0.2s;">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div id="passive-popup" class="passive-popup hidden"></div>
    </div>

    <div id="tutorial-modal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 500px;">
            <div id="tutorial-pages">
                <!-- –¢—É—Ç–æ—Ä–∏–∞–ª –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç–æ–º -->
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                <button id="tutorial-prev">–ù–∞–∑–∞–¥</button>
                <button id="tutorial-next">–î–∞–ª–µ–µ</button>
            </div>
            <button id="tutorial-close" style="margin-top: 15px; width: 100%;">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
    
    <script src="items.js"></script>
    <script type="module" src="tutorial.js"></script>
    <script src="passives.js"></script>
    <script src="skript.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const statsModal = document.getElementById('run-stats-modal');
            const showStatsBtn = document.getElementById('btn-show-run-stats');
            const closeStatsBtn = document.getElementById('btn-close-run-stats');

            const passivesContainer = document.getElementById('stats-active-passives');

            function populateStats() {
                console.log('populateStats –≤—ã–∑–≤–∞–Ω–∞');
                console.log('window.state:', window.state);
                console.log('window.symbolWeights:', window.symbolWeights);
                console.log('window.symbols:', window.symbols);
                
                // 1. –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–∞—Å—Å–∏–≤–∫–∏ (—Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏—è-–∫–Ω–æ–ø–∫–∏)
                if (window.state && window.state.activePassives) {
                    const passivesContainer = document.getElementById('stats-active-passives');
                    passivesContainer.innerHTML = '';
                    if (window.state.activePassives.length > 0) {
                        window.state.activePassives.forEach(passive => {
                            const btn = document.createElement('button');
                            btn.className = 'compact-passive-btn';
                            btn.innerHTML = `${passive.emoji || ''} ${passive.name}`;
                            btn.onclick = () => showPassivePopup(passive);
                            passivesContainer.appendChild(btn);
                        });
                    } else {
                        passivesContainer.innerHTML = '<p style="text-align: center; font-size: 0.9em; color: var(--text-color-darker); font-style: italic;">–ù–µ—Ç –ø–∞—Å—Å–∏–≤–æ–∫.</p>';
                    }
                }
                // 2. –®–∞–Ω—Å—ã —Å–∏–º–≤–æ–ª–æ–≤ (–∫—Ä–∞—Å–∏–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏)
                if (window.symbols && window.symbolWeights) {
                    const chancesDiv = document.getElementById('stats-symbol-chances');
                    chancesDiv.innerHTML = '';
                    const removedSymbols = [];
                    if (window.state && window.state.inventory) {
                        const removeItem = window.state.inventory.find(item => item.effect?.remove_symbol);
                        if (removeItem) removedSymbols.push(removeItem.effect.remove_symbol);
                    }
                    window.symbols.forEach(symbol => {
                        const weight = window.symbolWeights[symbol.id] || 0;
                        const percentage = window.totalWeight > 0 ? ((weight / window.totalWeight) * 100).toFixed(1) : '0.0';
                        const isRemoved = removedSymbols.includes(symbol.id);
                        const card = document.createElement('div');
                        card.className = 'styled-symbol-chance';
                        if (isRemoved) card.style.opacity = '0.4';
                        card.innerHTML = `
                            <div class="symbol-emoji">${symbol.graphic}</div>
                            <div class="symbol-name">${symbol.id}</div>
                            <div class="symbol-chance">${percentage}%</div>
                        `;
                        chancesDiv.appendChild(card);
                    });
                }
            }

            function showPassivePopup(passive) {
                const popup = document.getElementById('passive-popup');
                popup.innerHTML = `
                    <div class="popup-title">${passive.emoji || ''} ${passive.name}</div>
                    <div class="popup-type">${passive.type || ''}</div>
                    <div class="popup-desc">${passive.desc || ''}</div>
                    <button class="popup-close">–ó–∞–∫—Ä—ã—Ç—å</button>
                `;
                popup.classList.remove('hidden');
                popup.querySelector('.popup-close').onclick = () => popup.classList.add('hidden');
                popup.onclick = (e) => { if (e.target === popup) popup.classList.add('hidden'); };
            }

            showStatsBtn.addEventListener('click', () => {
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                if (window.updateWeightedSymbols) {
                    window.updateWeightedSymbols();
                }
                populateStats();
                statsModal.classList.remove('hidden');
            });

            closeStatsBtn.addEventListener('click', () => {
                statsModal.classList.add('hidden');
            });
            
            statsModal.addEventListener('click', (event) => {
                if (event.target === statsModal) {
                    statsModal.classList.add('hidden');
                }
            });
        });
      // document.getElementById('switch-style2-btn').onclick = function() {
      //   window.location.href = 'style2/index_style2.html';
      // };
        document.addEventListener('DOMContentLoaded', () => {
            const logWrapper = document.getElementById('log-panel-wrapper');
            const toggleBtn = document.getElementById('btn-toggle-log');
            const closeBtn = document.getElementById('btn-close-log');
            
            if (toggleBtn) {
                toggleBtn.addEventListener('click', () => {
                    logWrapper.classList.toggle('visible');
                });
            }

            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    logWrapper.classList.remove('visible');
                });
            }
        });
    </script>
    <script type="module">
      import { startTutorial } from './tutorial.js';
      window.addEventListener('DOMContentLoaded', () => {
        const btn = document.getElementById('btn-show-tutorial');
        if (btn) btn.onclick = startTutorial;
      });
    </script>
    <style>
    @keyframes debt-pulse {
      0% { filter: brightness(1); transform: scale(1); }
      100% { filter: brightness(1.5); transform: scale(1.08); }
    }
    .dev-section {
        margin: 15px 0;
        padding: 15px;
        background: var(--cell-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
    }
    .dev-section h3 {
        margin: 0 0 10px 0;
        color: var(--highlight-color);
        font-size: 1.1em;
    }
    .dev-buttons {
        display: grid;
        gap: 8px;
    }
    .dev-button {
        padding: 8px 12px;
        border: 1px solid var(--border-color);
        background: var(--button-bg);
        color: var(--text-color);
        border-radius: 4px;
        cursor: pointer;
        transition: 0.2s;
    }
    .dev-button:hover {
        background: var(--button-hover-bg);
    }
    .dev-button.money {
        color: var(--money-color);
        border-color: var(--money-color);
    }
    .dev-button.ticket {
        color: var(--ticket-color);
        border-color: var(--ticket-color);
    }
    .dev-item-control, .dev-luck-control {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-direction: row;
        flex-wrap: wrap;
    }
    .dev-select, .dev-input {
        flex: 1;
        padding: 8px;
        background: var(--input-bg);
        border: 1px solid var(--border-color);
        color: var(--text-color);
        border-radius: 4px;
    }
    .dev-select option {
        /* –ë—Ä–∞—É–∑–µ—Ä—ã –ø–æ-—Ä–∞–∑–Ω–æ–º—É –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Å—Ç–∏–ª–∏ –æ–ø—Ü–∏–π, 
           –ø–æ—ç—Ç–æ–º—É –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–∏–¥ */
        background: #242424;
        color: #eaeaea;
    }
    .dev-chances {
        margin: 10px 0;
        display: grid;
        gap: 8px;
        grid-template-columns: 1fr auto;
        align-items: center;
    }
    .dev-chances label {
        justify-self: start;
    }
    .dev-chances input {
         width: 60px;
         padding: 4px;
         background: var(--input-bg);
         border: 1px solid var(--border-color);
         color: var(--text-color);
         border-radius: 3px;
    }
    .dev-close {
        width: 100%;
        margin-top: 20px;
        background: var(--danger-color);
        color: #fff;
        border: none;
    }
    .dev-close:hover {
         filter: brightness(1.2);
    }
    #dev-menu-btn {
        position: fixed;
        top: 10px;
        right: 10px;
        z-index: 1000;
        padding: 7px 16px;
        font-size: 15px;
        background: #222;
        color: #fff;
        border: 1px solid #444;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        transition: background-color 0.2s;
    }
    #dev-menu-btn:hover {
        background: #333;
    }
    /* --- –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–Ω–µ–ª–∏ –ª–æ–≥–∞ --- */
    .log-panel-wrapper {
        position: fixed;
        left: 0;
        top: 0;
        height: 100vh;
        width: 320px;
        max-width: 90%;
        background-color: var(--bg-color, #1a1a1a);
        border-right: 1px solid var(--border-color, #444);
        z-index: 1800;
        display: flex;
        flex-direction: column;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        box-shadow: 4px 0 15px rgba(0,0,0,0.2);
    }
    .log-panel-wrapper.visible {
        transform: translateX(0);
    }
    .log-panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        border-bottom: 1px solid var(--border-color, #444);
        background-color: var(--cell-bg, #232323);
    }
    .log-panel-header h3 {
        margin: 0;
        font-size: 1.1em;
        color: var(--highlight-color);
    }
    .log-panel-close {
        background: none;
        border: none;
        color: var(--text-color, #fff);
        font-size: 24px;
        cursor: pointer;
        padding: 0 8px;
        line-height: 1;
    }
    .log-panel-close:hover {
        color: var(--danger-color);
    }
    #log-panel p:first-child {
        margin-top: 0;
    }
    #log-panel p:last-child {
        margin-bottom: 0;
    }

    /* --- –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ --- */
    .stats-section {
        margin-bottom: 15px;
        padding: 15px;
        background: var(--panel-bg, #1a1a1a);
        border: 2px solid var(--border-color, #444);
        border-radius: 8px;
        box-shadow: inset 0 0 10px #000;
    }
    .stats-section h3 {
        margin: 0 0 12px 0;
        color: var(--highlight-color, #ffd700);
        font-size: 1.1em;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-bottom: 1px solid var(--border-color, #444);
        padding-bottom: 8px;
    }
    #stats-symbol-chances {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 10px;
        text-align: center;
    }
    #stats-symbol-chances .chance-item {
        background-color: var(--cell-bg, #2a2a2a);
        padding: 8px;
        border-radius: 4px;
        border: 1px solid var(--border-color, #444);
    }
    #stats-symbol-chances .symbol-emoji {
        font-size: 1.6em;
        display: block;
        line-height: 1;
    }
    #stats-symbol-chances .symbol-chance-text {
        font-size: 0.9em;
        color: var(--text-color, #fff);
        font-weight: bold;
    }

    /* --- UI –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–∞—Å—Å–∏–≤–∫–∏ (–≤ —Å—Ç–∏–ª–µ –∏–≥—Ä—ã) --- */
    #passive-choice-modal.modal-overlay {
      position: fixed;
      z-index: 2000;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.72);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #passive-choice-modal .modal-card {
      background: var(--cell-bg, #232323);
      border-radius: 12px;
      padding: 28px 24px 20px 24px;
      box-shadow: 0 4px 24px #000a;
      min-width: 340px;
      max-width: 95vw;
      text-align: center;
      color: var(--text-color, #fff);
      position: relative;
      border: 1.5px solid var(--border-color, #444);
    }
    #passive-choice-modal h2 {
      margin-bottom: 18px;
      font-size: 1.25em;
      color: var(--highlight-color, #ffd700);
      letter-spacing: 0.5px;
    }
    #passive-choices {
      margin-bottom: 18px;
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    .passive-choice-card {
      background: var(--input-bg, #292929);
      border: 1.5px solid var(--border-color, #444);
      border-radius: 8px;
      padding: 14px 10px 10px 10px;
      min-width: 120px;
      min-height: 90px;
      cursor: pointer;
      transition: border-color 0.18s, box-shadow 0.18s, background 0.18s, transform 0.12s;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 1em;
      box-shadow: 0 1px 4px #0002;
    }
    .passive-choice-card.selected, .passive-choice-card:focus {
      border-color: var(--highlight-color, #ffd700);
      background: #2a2512;
      box-shadow: 0 0 0 2px #ffd70033;
      transform: scale(1.03);
    }
    .passive-choice-card:hover {
      border-color: var(--ticket-color, #b388ff);
      background: #23202a;
      box-shadow: 0 0 0 1.5px #b388ff33;
      transform: scale(1.02);
    }
    .passive-choice-emoji {
      font-size: 1.7em;
      margin-bottom: 6px;
      filter: drop-shadow(0 1px 2px #0005);
    }
    .passive-choice-name {
      font-weight: bold;
      margin-bottom: 4px;
      color: var(--highlight-color, #ffd700);
      font-size: 1em;
    }
    .passive-choice-desc {
      color: var(--text-color, #ccc);
      font-size: 0.97em;
      margin-bottom: 0;
    }
    #passive-confirm-btn {
      background: var(--highlight-color, #ffd700);
      color: #222;
      border: none;
      border-radius: 6px;
      font-size: 1em;
      font-weight: bold;
      padding: 8px 26px;
      cursor: pointer;
      box-shadow: 0 1px 4px #0002;
      transition: background 0.18s, color 0.18s;
      margin-top: 6px;
    }
    #passive-confirm-btn:disabled {
      background: #888;
      color: #eee;
      cursor: not-allowed;
      opacity: 0.7;
    }
    .deposit-dropdown {
        position: absolute;
        left: 0;
        top: 40px;
        background: var(--cell-bg, #232323);
        border: 1px solid var(--border-color, #444);
        border-radius: 6px;
        box-shadow: 0 2px 12px #0005;
        z-index: 2000;
        min-width: 180px;
        padding: 4px 0;
    }
    .deposit-dropdown.hidden { display: none; }
    .deposit-option {
        padding: 10px 18px;
        cursor: pointer;
        color: var(--text-color, #fff);
        font-size: 15px;
        transition: background 0.15s;
    }
    .deposit-option:hover {
        background: var(--highlight-color, #ffd700);
        color: var(--bg-color, #222);
    }
    
    .modal-actions {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin: 20px 0;
    }

    .modal-actions button {
        width: 100%;
    }
    
    @keyframes item-pulse-effect {
        0% {
            transform: scale(1);
            box-shadow: 0 0 0 0px var(--highlight-color);
        }
        50% {
            transform: scale(1.08);
            box-shadow: 0 0 10px 4px rgba(255, 215, 0, 0.5);
            border-color: var(--highlight-color);
        }
        100% {
            transform: scale(1);
            box-shadow: 0 0 0 0px rgba(255, 215, 0, 0);
        }
    }
    .item.item-activated {
        animation: item-pulse-effect 0.8s ease-out;
        position: relative; /* Needed for z-index if any */
        z-index: 10;
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–æ–≤ */
    .ticket-change-popup, .coin-change-popup {
        position: fixed;
        font-weight: bold;
        font-size: 1.1em;
        z-index: 2000;
        pointer-events: none;
        animation: move-up-fade-out 1.5s ease-out forwards;
        transform: translateY(-50%); /* –î–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è */
        text-shadow: 0 0 4px rgba(0,0,0,0.7);
    }

    .ticket-change-popup.gain, .coin-change-popup.gain {
        color: var(--ticket-color);
    }

    .ticket-change-popup.loss, .coin-change-popup.loss {
        color: var(--danger-color);
    }

    .coin-change-popup.gain {
        color: var(--money-color);
    }

    @keyframes move-up-fade-out {
        0% {
            opacity: 1;
            transform: translateY(-50%);
        }
        100% {
            opacity: 0;
            transform: translateY(-150%);
        }
    }

    .passive-item {
        padding: 12px;
        margin: 6px 0;
        background: var(--cell-bg, #2a2a2a);
        border: 1px solid var(--border-color, #444);
        border-radius: 6px;
        display: flex;
        align-items: center;
        gap: 12px;
        box-shadow: inset 0 0 5px #000;
        transition: border-color 0.2s, background 0.2s;
    }
    
    .passive-item:hover {
        border-color: var(--highlight-color, #ffd700);
        background: var(--input-bg, #323232);
    }
    
    .passive-emoji {
        font-size: 1.8em;
        filter: drop-shadow(0 1px 2px #0005);
    }
    
    .passive-content {
        flex: 1;
    }
    
    .passive-name {
        font-weight: bold;
        margin-bottom: 6px;
        color: var(--highlight-color, #ffd700);
        font-size: 1.1em;
        letter-spacing: 0.5px;
    }
    
    .passive-desc {
        font-size: 0.9em;
        color: var(--text-color, #ccc);
        margin-bottom: 6px;
        line-height: 1.4;
    }
    
    .passive-type-badge {
        font-size: 0.8em;
        padding: 3px 8px;
        border-radius: 4px;
        display: inline-block;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .symbol-weight-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        margin: 4px 0;
        background: var(--cell-bg, #2a2a2a);
        border: 1px solid var(--border-color, #444);
        border-radius: 6px;
        box-shadow: inset 0 0 3px #000;
        transition: border-color 0.2s, background 0.2s;
    }
    
    .symbol-weight-row:hover {
        border-color: var(--highlight-color, #ffd700);
        background: var(--input-bg, #323232);
    }
    
    .symbol-weight-row:last-child {
        margin-bottom: 0;
    }
    
    .symbol-weight-symbol {
        font-size: 1.4em;
        margin-right: 12px;
        filter: drop-shadow(0 1px 2px #0005);
    }
    
    .symbol-weight-info {
        flex: 1;
    }
    
    .symbol-weight-name {
        font-weight: bold;
        font-size: 1em;
        color: var(--text-color, #fff);
        text-transform: capitalize;
        letter-spacing: 0.5px;
    }
    
    .symbol-weight-details {
        font-size: 0.85em;
        color: var(--text-color-darker, #aaa);
        margin-top: 2px;
    }
    
    .symbol-weight-value {
        font-weight: bold;
        color: var(--highlight-color, #ffd700);
        font-size: 1em;
        text-shadow: 0 0 4px rgba(255, 215, 0, 0.3);
    }
    
    .symbol-weight-zero {
        color: var(--danger-color, #ff6b6b);
        opacity: 0.7;
        text-shadow: 0 0 4px rgba(255, 107, 107, 0.3);
    }
    
    .symbol-weight-removed {
        text-decoration: line-through;
        opacity: 0.4;
        background: rgba(255, 0, 0, 0.1);
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
    #btn-close-run-stats:hover {
        background: var(--button-hover-bg, #ffed4e) !important;
        transform: scale(1.02);
    }
    
    #btn-close-run-stats:active {
        transform: scale(0.98);
    }
    </style>
</body>
</html>